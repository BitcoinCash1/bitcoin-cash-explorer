<div class="container-xl" *ngIf="!error; else errorTemplate">
  <!-- Token overview -->
  <div *ngIf="getTokenInfo(); else loadingMain">
    @let tokenInfo = getTokenInfo();
    <div class="token-block mb-3">
      @if (tokenInfo.hasIcon) {
        <img
          width="50"
          height="50"
          [src]="resolveIconUrl(tokenInfo.uris.icon)"
          [alt]="tokenInfo.name + ' token icon'"
          class="mr-3"
        />
      } @else {
        <div
          class="skeleton-loader mr-3"
          style="width: 50px; height: 50px; border-radius: 50%"
        ></div>
      }
      <h1 class="token-title pt-1">{{ tokenInfo.name }}</h1>
      <span class="token-link">
        <app-truncate
          [text]="tokenInfo.category"
          [lastChars]="12"
          [maxWidth]="400"
          [link]="['/token/' | relativeUrl, tokenInfo.category]"
        >
          <span
            class="qrSpan"
            (mouseover)="showQR = true"
            (mouseout)="showQR = false"
            (pointerdown)="showQR = true"
          >
            <fa-icon
              [icon]="['fas', 'qrcode']"
              [fixedWidth]="true"
              [style.font-size]="isMobile ? '18px' : '12px'"
            ></fa-icon>
            <div class="qr-wrapper" [hidden]="!showQR">
              <app-qrcode [size]="200" [data]="tokenInfo.category"></app-qrcode>
            </div>
          </span>
          <app-clipboard
            [text]="tokenInfo.category"
            [size]="isMobile ? 'large' : 'normal'"
          ></app-clipboard>
        </app-truncate>
      </span>
    </div>

    <div class="box token-details">
      <div class="row">
        <div class="col-lg-6">
          <table
            class="table table-borderless table-striped"
            style="table-layout: fixed"
          >
            <tbody>
              <!-- Repeat the name  -->
              <tr>
                <td class="label">Name</td>
                <td style="vertical-align: middle">
                  {{ tokenInfo.name }}
                </td>
              </tr>

              <!-- Symbol -->
              @if (tokenInfo.symbol !== "N/A") {
                <tr>
                  <td class="label">Symbol</td>
                  <td style="vertical-align: middle">
                    <span class="badge bg-secondary token-symbol">{{
                      tokenInfo.symbol
                    }}</span>
                  </td>
                </tr>
              }

              <!-- Decimals -->
              @if (tokenInfo.decimals !== "N/A") {
                <tr>
                  <td class="label">Decimals</td>
                  <td style="vertical-align: middle">
                    {{ tokenInfo.decimals }}
                  </td>
                </tr>
              }

              <!-- Type -->
              @if (tokenInfo.isNft) {
                <tr>
                  <td class="label">Type</td>
                  <td style="vertical-align: middle">
                    <span class="badge bg-info">NFT</span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <div class="col-lg-6">
          <table class="table table-borderless table-striped">
            <tbody>
              <!-- Status -->
              @if (tokenInfo.status !== "unknown") {
                <tr>
                  <td class="label">Status</td>
                  <td style="vertical-align: middle">
                    <span
                      class="badge"
                      [class]="getStatusClass(tokenInfo.status)"
                    >
                      {{ tokenInfo.status }}
                    </span>
                  </td>
                </tr>
              }

              <!-- Website -->
              @if (tokenInfo.hasWebsite) {
                <tr>
                  <td class="label">Website</td>
                  <td style="vertical-align: middle">
                    <a
                      [href]="tokenInfo.uris.web"
                      target="_blank"
                      rel="noopener noreferrer"
                      style="text-decoration: none"
                    >
                      {{ tokenInfo.uris.web }}
                      <span>&nbsp;</span>
                      <fa-icon
                        [icon]="['fas', 'external-link-alt']"
                        [fixedWidth]="true"
                        style="
                          vertical-align: text-top;
                          font-size: 13px;
                          color: var(--title-fg);
                        "
                      ></fa-icon>
                    </a>
                  </td>
                </tr>
              }

              <!-- Description -->
              @if (tokenInfo.hasDescription) {
                <tr>
                  <td class="label">Description</td>
                  <td style="vertical-align: middle">
                    {{ tokenInfo.description }}
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional URIs Section -->
  @if (getTokenInfo() && hasAdditionalUris(getTokenInfo().uris)) {
    @let tokenInfo = getTokenInfo();
    <br />
    <h2>Additional Resources</h2>
    <div class="box mb-3">
      <div class="row">
        <div class="col">
          <table class="table table-borderless table-striped">
            <tbody>
              <tr>
                <td>
                  <div class="row">
                    @for (
                      uri of getAdditionalUris(tokenInfo.uris);
                      track uri.key
                    ) {
                      <div class="col-md-6 mb-2">
                        <strong>{{ uri.key }}:</strong>
                        <a
                          [href]="uri.value"
                          target="_blank"
                          rel="noopener noreferrer"
                          style="text-decoration: none"
                          class="ms-2"
                        >
                          {{ uri.value }}
                          <span>&nbsp;</span>
                          <fa-icon
                            [icon]="['fas', 'external-link-alt']"
                            [fixedWidth]="true"
                            style="
                              vertical-align: text-top;
                              font-size: 13px;
                              color: var(--title-fg);
                            "
                          ></fa-icon>
                        </a>
                      </div>
                    }
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  }
</div>

<!-- Error template -->
<ng-template #errorTemplate>
  <div class="container-xl">
    <div class="box">
      <div class="icon-container">
        <fa-icon
          [icon]="['fas', 'exclamation-triangle']"
          [fixedWidth]="true"
        ></fa-icon>
      </div>
      <span>
        <strong>Error:</strong>
        {{ error?.message || "Failed to load token metadata" }}
      </span>
    </div>
  </div>
</ng-template>

<!-- Main loading template -->
<ng-template #loadingMain>
  <div>
    <div class="mb-3" style="display: flex; position: relative">
      <div
        class="skeleton-loader mr-3"
        style="width: 50px; height: 50px; border-radius: 50%"
      ></div>
      <h1 class="m-0 pt-1 pt-md-0">
        <div
          class="skeleton-loader"
          style="position: absolute; top: 32%; width: 150px; height: 20px"
        ></div>
      </h1>
    </div>

    <div class="box">
      <div class="row">
        <div class="col-lg-6">
          <table
            class="table table-borderless table-striped"
            style="table-layout: fixed"
          >
            <tbody>
              <tr>
                <td class="label">Category</td>
                <td style="vertical-align: middle">
                  <div class="skeleton-loader"></div>
                </td>
              </tr>
              <tr>
                <td class="label">Symbol</td>
                <td style="vertical-align: middle">
                  <div class="skeleton-loader"></div>
                </td>
              </tr>
              <tr>
                <td class="label">Decimals</td>
                <td style="vertical-align: middle">
                  <div class="skeleton-loader"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="col-lg-6">
          <table class="table table-borderless table-striped">
            <tbody>
              <tr>
                <td class="label">Status</td>
                <td style="vertical-align: middle">
                  <div class="skeleton-loader"></div>
                </td>
              </tr>
              <tr>
                <td class="label">Website</td>
                <td style="vertical-align: middle">
                  <div class="skeleton-loader"></div>
                </td>
              </tr>
              <tr>
                <td class="label">Description</td>
                <td style="vertical-align: middle">
                  <div class="skeleton-loader"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</ng-template>
